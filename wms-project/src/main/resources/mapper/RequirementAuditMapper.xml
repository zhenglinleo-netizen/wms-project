<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.wms.mapper.RequirementAuditMapper">
    
    <!-- 插入需求审核记录 -->
    <insert id="insert" parameterType="com.example.wms.entity.RequirementAudit">
        INSERT INTO requirement_audit (requirement_id, requirement_data, total_amount, submitted_by, submitted_at, status, rejection_reason)
        VALUES (#{requirementId}, #{requirementData}, #{totalAmount}, #{submittedBy}, #{submittedAt}, #{status}, #{rejectionReason})
    </insert>
    
    <!-- 根据ID查询需求审核记录 -->
    <select id="selectById" resultType="com.example.wms.entity.RequirementAudit" parameterType="java.lang.Long">
        SELECT * FROM requirement_audit WHERE id = #{id}
    </select>
    
    <!-- 更新需求审核记录 -->
    <update id="updateById" parameterType="com.example.wms.entity.RequirementAudit">
        UPDATE requirement_audit 
        <set>
            <if test="requirementId != null">requirement_id = #{requirementId},</if>
            <if test="requirementData != null">requirement_data = #{requirementData},</if>
            <if test="totalAmount != null">total_amount = #{totalAmount},</if>
            <if test="submittedBy != null">submitted_by = #{submittedBy},</if>
            <if test="submittedAt != null">submitted_at = #{submittedAt},</if>
            <if test="auditedBy != null">audited_by = #{auditedBy},</if>
            <if test="auditedAt != null">audited_at = #{auditedAt},</if>
            <if test="status != null">status = #{status},</if>
            <if test="rejectionReason != null">rejection_reason = #{rejectionReason},</if>
        </set>
        WHERE id = #{id}
    </update>
    
    <!-- 根据需求ID查询最新的需求审核记录 -->
    <select id="selectLatestByRequirementId" resultType="com.example.wms.entity.RequirementAudit" parameterType="java.lang.Long">
        SELECT * FROM requirement_audit 
        WHERE requirement_id = #{requirementId} 
        ORDER BY submitted_at DESC 
        LIMIT 1
    </select>
</mapper>
